#!/usr/bin/env node

// Dependencies
var Logger = require("bug-killer")
  , OArgv = require("oargv")
  , CLP = require("clp")
  , Path = require("path")
  , Ul = require("ul")
  , Package = require("../package")
  , BloggifyServer = require("../lib/server")
  , IsThere = require("is-there")
  ;

// Configurations
Logger.config.displayDate = false;
Logger.config.logLevel = 4;

var parser = new CLP({
    name: "Bloggify"
  , version: Package.version
  , exe: Package.name
  , examples: [
        "bloggify -c path/to/some-site"
      , "bloggify -h"
    ]
  , docs_url: "https://github.com/Bloggify/Bloggify"
});


var configOption = new CLP.Option(["config", "c"], "The path to the config file or site directory.", "config")

parser.addOption(configOption);
parser.process();

if (!configOption.value) {
    return Logger.log("Please provide a path to the config file.", "error");
} else {
    configOption.value = Path.resolve(process.cwd(), configOption.value);
}

var confPath = configOption.value;
if (/\.json$/.test(confPath)) {
    confPath = confPath + "/conf/index.json";
}

if (!IsThere.sync(confPath)) {
    return Logger.log("The configuration file is not found.", "error");
}

BloggifyServer.start(confPath, function (message) {
    Bloggify.log(message, "info");
}, function (err, data) {
    if (err) {
        return Bloggify.log(err, "error");
    }
    Bloggify.log(data, "info");
});
